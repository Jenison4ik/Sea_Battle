# –ú–æ—Ä—Å–∫–æ–π –±–æ–π - Backend Server

Backend —Å–µ—Ä–≤–µ—Ä –¥–ª—è –º–Ω–æ–≥–æ–ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π –∏–≥—Ä—ã "–ú–æ—Ä—Å–∫–æ–π –±–æ–π" –Ω–∞ C++ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º Crow –∏ WebSocket.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

- **–Ø–∑—ã–∫**: C++17
- **–§—Ä–µ–π–º–≤–æ—Ä–∫**: Crow
- **–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç**: WebSocket
- **–ö–æ–Ω—Ç–µ–π–Ω–µ—Ä–∏–∑–∞—Ü–∏—è**: Docker + Docker Compose
- **–ü—Ä–æ–∫—Å–∏**: Nginx (reverse proxy + WebSocket upgrade)

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
sea-battle/
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ include/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ types.h              # –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö (GameSession, Player, Board, Ship)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ session_manager.h    # –ú–µ–Ω–µ–¥–∂–µ—Ä –∏–≥—Ä–æ–≤—ã—Ö —Å–µ—Å—Å–∏–π
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ game_engine.h        # –õ–æ–≥–∏–∫–∞ –∏–≥—Ä—ã –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ json_serializer.h    # –°–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è JSON —Å–æ–æ–±—â–µ–Ω–∏–π
‚îÇ   ‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ types.cpp            # –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –º–µ—Ç–æ–¥–æ–≤ Board
‚îÇ   ‚îú‚îÄ‚îÄ main.cpp                 # WebSocket –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∏ —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ CMakeLists.txt           # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è —Å–±–æ—Ä–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ Dockerfile               # Docker –æ–±—Ä–∞–∑ –¥–ª—è backend
‚îú‚îÄ‚îÄ nginx/
‚îÇ   ‚îî‚îÄ‚îÄ nginx.conf               # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Nginx
‚îî‚îÄ‚îÄ docker-compose.yml           # –û—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–æ–≤
```

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

### –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è

- Docker –∏ Docker Compose
- Git

### –ó–∞–ø—É—Å–∫

```bash
# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
git clone <repository-url>
cd sea-battle

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up --build

# –ò–ª–∏ –≤ —Ñ–æ–Ω–æ–≤–æ–º —Ä–µ–∂–∏–º–µ
docker-compose up -d --build
```

–°–µ—Ä–≤–µ—Ä –±—É–¥–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É: `ws://localhost/ws`

### –û—Å—Ç–∞–Ω–æ–≤–∫–∞

```bash
docker-compose down
```

## üîå WebSocket API

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ

```
ws://localhost/ws
```

### –ü—Ä–æ—Ç–æ–∫–æ–ª —Å–æ–æ–±—â–µ–Ω–∏–π

–í—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–µ—Ä–µ–¥–∞—é—Ç—Å—è –≤ —Ñ–æ—Ä–º–∞—Ç–µ JSON.

#### 1. –°–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏

**–ö–ª–∏–µ–Ω—Ç ‚Üí –°–µ—Ä–≤–µ—Ä:**

```json
{
  "type": "CREATE_SESSION"
}
```

**–°–µ—Ä–≤–µ—Ä ‚Üí –ö–ª–∏–µ–Ω—Ç:**

```json
{
  "type": "SESSION_CREATED",
  "roomCode": "A7F3Q2"
}
```

#### 2. –ü—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ –∫ —Å–µ—Å—Å–∏–∏

**–ö–ª–∏–µ–Ω—Ç ‚Üí –°–µ—Ä–≤–µ—Ä:**

```json
{
  "type": "JOIN_SESSION",
  "roomCode": "A7F3Q2"
}
```

**–°–µ—Ä–≤–µ—Ä ‚Üí –û–±–æ–∏–º –∏–≥—Ä–æ–∫–∞–º:**

```json
{
  "type": "GAME_START",
  "firstTurn": "player1"
}
```

#### 3. –†–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ—Ä–∞–±–ª–µ–π

**–ö–ª–∏–µ–Ω—Ç ‚Üí –°–µ—Ä–≤–µ—Ä:**

```json
{
  "type": "PLACE_SHIPS",
  "ships": [
    [
      [1, 1],
      [1, 2],
      [1, 3],
      [1, 4]
    ], // 4-–ø–∞–ª—É–±–Ω—ã–π
    [
      [3, 1],
      [3, 2],
      [3, 3]
    ], // 3-–ø–∞–ª—É–±–Ω—ã–π
    [
      [3, 5],
      [3, 6]
    ], // 2-–ø–∞–ª—É–±–Ω—ã–π
    [[5, 1]] // 1-–ø–∞–ª—É–±–Ω—ã–π
    // ... –≤—Å–µ–≥–æ 10 –∫–æ—Ä–∞–±–ª–µ–π: 1x4, 2x3, 3x2, 4x1
  ]
}
```

**–°–µ—Ä–≤–µ—Ä ‚Üí –ö–ª–∏–µ–Ω—Ç:**

```json
{
  "type": "SHIPS_PLACED"
}
```

#### 4. –í—ã—Å—Ç—Ä–µ–ª

**–ö–ª–∏–µ–Ω—Ç ‚Üí –°–µ—Ä–≤–µ—Ä:**

```json
{
  "type": "SHOT",
  "x": 1,
  "y": 2
}
```

**–°–µ—Ä–≤–µ—Ä ‚Üí –¢–µ–∫—É—â–∏–π –∏–≥—Ä–æ–∫ (MY_SHOT):**

```json
{
  "type": "STATE",
  "mode": "MY_SHOT",
  "data": {
    "ships": [
      {
        "heated_cords": [
          [1, 2],
          [1, 3]
        ],
        "isKilled": false
      }
    ],
    "shooted_cords": [
      [1, 2],
      [1, 3],
      [5, 6]
    ]
  }
}
```

**–°–µ—Ä–≤–µ—Ä ‚Üí –ü—Ä–æ—Ç–∏–≤–Ω–∏–∫ (ENEMY_SHOT):**

```json
{
  "type": "STATE",
  "mode": "ENEMY_SHOT",
  "data": {
    "ships": [
      {
        "first_cord": [1, 2],
        "sec_cord": [1, 5],
        "heated_cords": [
          [1, 2],
          [1, 3]
        ],
        "isKilled": false
      }
    ],
    "shooted_cords": [
      [1, 2],
      [1, 3],
      [5, 6]
    ]
  }
}
```

#### 5. –ö–æ–Ω–µ—Ü –∏–≥—Ä—ã

**–°–µ—Ä–≤–µ—Ä ‚Üí –û–±–æ–∏–º –∏–≥—Ä–æ–∫–∞–º:**

```json
{
  "type": "GAME_OVER",
  "winner": "player1",
  "stats": {
    "shots": 34,
    "hits": 10,
    "misses": 24,
    "accuracy": 29.4,
    "sunkShips": 3
  }
}
```

#### 6. –û—à–∏–±–∫–∏

**–°–µ—Ä–≤–µ—Ä ‚Üí –ö–ª–∏–µ–Ω—Ç:**

```json
{
  "type": "ERROR",
  "message": "–û–ø–∏—Å–∞–Ω–∏–µ –æ—à–∏–±–∫–∏"
}
```

#### 7. Heartbeat

**–ö–ª–∏–µ–Ω—Ç ‚Üí –°–µ—Ä–≤–µ—Ä:**

```json
{
  "type": "PING"
}
```

**–°–µ—Ä–≤–µ—Ä ‚Üí –ö–ª–∏–µ–Ω—Ç:**

```json
{
  "type": "PONG"
}
```

## üéÆ –ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã

1. **–†–∞—Å—Å—Ç–∞–Ω–æ–≤–∫–∞ –∫–æ—Ä–∞–±–ª–µ–π:**

   - 1 –∫–æ—Ä–∞–±–ª—å –Ω–∞ 4 –∫–ª–µ—Ç–∫–∏
   - 2 –∫–æ—Ä–∞–±–ª—è –Ω–∞ 3 –∫–ª–µ—Ç–∫–∏
   - 3 –∫–æ—Ä–∞–±–ª—è –Ω–∞ 2 –∫–ª–µ—Ç–∫–∏
   - 4 –∫–æ—Ä–∞–±–ª—è –Ω–∞ 1 –∫–ª–µ—Ç–∫—É
   - –ö–æ—Ä–∞–±–ª–∏ –Ω–µ –¥–æ–ª–∂–Ω—ã —Å–æ–ø—Ä–∏–∫–∞—Å–∞—Ç—å—Å—è
   - –ö–æ—Ä–∞–±–ª–∏ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω—ã–º–∏ (–≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ –∏–ª–∏ –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–æ)

2. **–•–æ–¥—ã:**

   - –ü—Ä–∏ –ø—Ä–æ–º–∞—Ö–µ (MISS) —Ö–æ–¥ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –∫ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫—É
   - –ü—Ä–∏ –ø–æ–ø–∞–¥–∞–Ω–∏–∏ (HIT) —Ö–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è —É —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
   - –ü—Ä–∏ —É–±–∏–π—Å—Ç–≤–µ –∫–æ—Ä–∞–±–ª—è (KILL) —Ö–æ–¥ –æ—Å—Ç–∞–µ—Ç—Å—è —É —Ç–µ–∫—É—â–µ–≥–æ –∏–≥—Ä–æ–∫–∞
   - –ü—Ä–∏ –ø–æ–±–µ–¥–µ (WIN) –∏–≥—Ä–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è

3. **–ü–æ–±–µ–¥–∞:**
   - –ò–≥—Ä–æ–∫ –ø–æ–±–µ–∂–¥–∞–µ—Ç, –∫–æ–≥–¥–∞ –≤—Å–µ –∫–æ—Ä–∞–±–ª–∏ –ø—Ä–æ—Ç–∏–≤–Ω–∏–∫–∞ —É–Ω–∏—á—Ç–æ–∂–µ–Ω—ã

## üîß –†–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –õ–æ–∫–∞–ª—å–Ω–∞—è —Å–±–æ—Ä–∫–∞ (–±–µ–∑ Docker)

```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (Ubuntu/Debian)
sudo apt-get update
sudo apt-get install -y build-essential cmake git libboost-all-dev

# –°–±–æ—Ä–∫–∞ Crow
cd /tmp
git clone https://github.com/CrowCpp/Crow.git
cd Crow
mkdir build && cd build
cmake .. -DCROW_BUILD_EXAMPLES=OFF -DCROW_BUILD_TESTS=OFF
cmake --build .
sudo cmake --install . --prefix /usr/local

# –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
cd /path/to/sea-battle/backend
mkdir build && cd build
cmake ..
cmake --build .

# –ó–∞–ø—É—Å–∫
./SeaBattleBackend
```

### –õ–æ–≥–∏

–õ–æ–≥–∏ —Å–µ—Ä–≤–µ—Ä–∞ –º–æ–∂–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å:

```bash
# –õ–æ–≥–∏ backend
docker-compose logs backend

# –õ–æ–≥–∏ nginx
docker-compose logs nginx

# –í—Å–µ –ª–æ–≥–∏
docker-compose logs -f
```

## üõ†Ô∏è –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

- **–ü–æ—Ç–æ–∫–æ–±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å**: –ö–∞–∂–¥–∞—è GameSession –∑–∞—â–∏—â–µ–Ω–∞ –º—å—é—Ç–µ–∫—Å–æ–º
- **–¢–∞–π–º–∞—É—Ç—ã**: –°–µ—Å—Å–∏–∏ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è—é—Ç—Å—è –ø–æ—Å–ª–µ 30 –º–∏–Ω—É—Ç –Ω–µ–∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏
- **–ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ**: –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è —á–µ—Ä–µ–∑ sticky-sessions –≤ Nginx
- **Heartbeat**: Ping/Pong –¥–ª—è –ø–æ–¥–¥–µ—Ä–∂–∞–Ω–∏—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è

## üìù Health Check

–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç–∏ —Å–µ—Ä–≤–µ—Ä–∞:

```bash
curl http://localhost/health
```

–î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å: `OK`

## üêõ –û—Ç–ª–∞–¥–∫–∞

–î–ª—è –æ—Ç–ª–∞–¥–∫–∏ –º–æ–∂–Ω–æ –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É:

```bash
# –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ backend –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—É
docker exec -it battleship-backend bash

# –ü—Ä–æ—Å–º–æ—Ç—Ä –ª–æ–≥–æ–≤ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
docker-compose logs -f backend
```

## üìÑ –õ–∏—Ü–µ–Ω–∑–∏—è

MIT
